/*! MCI-Framework 2015-01-21 */
!function($){"use strict";$(document).ready(function(){!function(){var $jsToggle=$(".js-toggle"),$jsToggleAll=$(".js-all-toggle"),$jsPrint=$(".js-print"),$jsBackToTop=$(".js-back-to-top"),$jsLegend=$(".js-legend"),$legend=$(".legend"),_isBarsExpanded=!1,_isLegendShown=!1,mY=0,dir="neutral";$jsToggle.bind("click",function(evt){evt.preventDefault();var newHover=e.relatedTarget;newHover!==$jsToggle[0]&&$.contains($jsToggle[0],newHover)}),$jsToggleAll.on("click",function(evt){evt.preventDefault();var _this=$(this);_isBarsExpanded?(_this.find("span").text("Expand All"),$(".details, .comments, .note.asterisk").slideUp(),$(".bar").removeClass("active").css({zoom:0}),setTimeout(function(){$(".bar").css({zoom:1})},200)):(_this.find("span").text("Collapse All"),$(".details, .comments, .note.asterisk").slideDown(),$(".bar").addClass("active").css({zoom:0}),setTimeout(function(){$(".bar").css({zoom:1})},200)),_isBarsExpanded=!_isBarsExpanded}),$jsPrint.on("click",function(evt){evt.preventDefault(),window.print()}),$jsBackToTop.on("click",function(evt){evt.preventDefault(),$("html,body").animate({scrollTop:0})}),$jsLegend.bind("mouseover",function(){_isLegendShown||$legend.slideDown()}).bind("click",function(){_isLegendShown?$legend.slideUp():$legend.slideDown(),_isLegendShown=!_isLegendShown}),$legend.bind("mouseout",function(e){var newHover=e.relatedTarget;newHover!==$legend[0]&&($.contains($legend[0],newHover)||_isLegendShown||"down"!=dir||$(this).slideUp())}).bind("mousemove",function(e){dir=e.pageY<mY?"up":"down",mY=e.pageY})}(),function(){function loadJson(){$(".btn-bar").off("click"),$(".inside").length?(loc="inside",$(".strategy").length?jsonPath="/json/results-hpb-strategy.json":$(".social").length?jsonPath="/json/results-hpb-social-media.json":$(".web").length&&(jsonPath="/json/results-hpb-web.json"),$.ajax({url:jsonPath,dataType:"text",success:function(dataTest){var json=$.parseJSON(dataTest);populateData(json,loc)}})):(loc="home",jsonPath="/json/home.json",$(".static").length?enableBars():$.ajax({url:jsonPath,dataType:"text",success:function(dataTest){var json=$.parseJSON(dataTest);populateData(json,loc)}}))}function populateData(json,loc){function enableBars(){{var $bar=$(".btn-bar");$("body")}$bar.each(function(){var _this=$(this).parent(),rate=Math.floor(_this.data("rate"));_this.addClass("NA"!==_this.data("rate")?"spectrum"+rate:"spectrumNA")}),$bar.on("click",function(){var _this=$(this).parent();_this.hasClass("active")?_this.removeClass("active"):_this.addClass("active"),null!==_this.data("link")&&void 0!==_this.data("link")&&""!==_this.data("link")?(console.log(_this.data("link")),$secondaryNav.find("li:nth-child("+_this.data("link")+") a").trigger("click")):(_this.hasClass("lvl3-bar")?_this.find(".comments").slideToggle(function(){_this.css({zoom:0})}):_this.hasClass("lvl1-bar")?$(".lvl2-bar").length?_this.next().slideToggle(function(){_this.css({zoom:0})}):_this.find(".comments").slideToggle(function(){_this.css({zoom:0})}):$(".lvl3-bar").length?_this.next().slideToggle(function(){_this.css({zoom:0})}):_this.find(".comments").slideToggle(function(){_this.css({zoom:0})}),setTimeout(function(){_this.css({zoom:1})},100))})}var introData="",injectData="";introData+="<h1>"+json.title+"</h1>",introData+="<p>"+json.description+"</p>";for(var i=0;i<json.results.length;i++)if(injectData+='<div class="bar lvl1-bar" data-rate="'+json.results[i].score+'" data-link="'+json.results[i].link+'" >',injectData+='<div class="btn-bar">',injectData+="<h2>"+json.results[i].title+"</h2>",injectData+='<div class="control">',injectData+='<span class="rate">'+json.results[i].score+"</span>",injectData+="inside"==loc?'<button class="icon-toggle js-toggle"><span class="visuallyhidden">Toggle</span></button>':'<button class="js-toggle"><i class="icon icon-chevron"></i></button>',injectData+="</div>",""!==json.results[i].description&&(injectData+='<div class="note">',injectData+='<i class="icon icon-info"></i><p>'+json.results[i].description+"</p>",injectData+="</div>"),injectData+="</div>",injectData+="</div>",""!==json.results[i].details_level_1){injectData+='<div class="details">',injectData+='<div class="wrap">';for(var j=0;j<json.results[i].details_level_1.length;j++)if(injectData+='<div class="bar lvl2-bar" data-rate="'+json.results[i].details_level_1[j].score+'">',injectData+='<div class="btn-bar">',injectData+="<h2>"+json.results[i].details_level_1[j].title+"</h2>",injectData+='<div class="control">',injectData+='<span class="rate">'+json.results[i].details_level_1[j].score+"</span>",injectData+='<button class="icon-toggle js-toggle">',injectData+='<span class="visuallyhidden">Toggle</span>',injectData+="</button>",injectData+="</div>",injectData+="</div>",injectData+='<div class="note">',""!==json.results[i].details_level_1[j].description&&(injectData+='<i class="icon icon-info"></i><p>'+json.results[i].details_level_1[j].description+"</p>"),""==json.results[i].details_level_1[j].details_level_2&&(injectData+='<div class="comments">',injectData+='<div class="wrap first">',console.log(json.results[i].details_level_1[j].indicator_for),void 0!==json.results[i].details_level_1[j].indicator_for?(injectData+='<div class="col col-6 first">',injectData+="<h4>Criteria</h4>",injectData+="<p>"+json.results[i].details_level_1[j].criteria+"</p>",injectData+="</div>",injectData+='<div class="col col-6 last">',injectData+="<h4>A high score indicates</h4>",injectData+="<p>"+json.results[i].details_level_1[j].indicator_for+"</p>",injectData+="</div>"):(injectData+='<div class="col col-12 only last">',injectData+="<h4>Criteria</h4>",injectData+="<p>"+json.results[i].details_level_1[j].criteria+"</p>",injectData+="</div>"),injectData+="</div>",injectData+='<div class="wrap last">',injectData+="<h4>Recommendations</h4>",injectData+="<p>"+json.results[i].details_level_1[j].recommendations+"</p>",void 0!==json.results[i].details_level_1[j].assessor&&(injectData+="<hr/>",injectData+="<h4>Assessor's Comments</h4>",injectData+="<p>"+json.results[i].details_level_1[j].assessor+"</p>"),injectData+="</div>",injectData+="</div>"),injectData+="</div>",injectData+="</div>",""!=json.results[i].details_level_1[j].details_level_2){injectData+='<div class="details">';for(var k=0;k<json.results[i].details_level_1[j].details_level_2.length;k++)injectData+='<div class="bar lvl3-bar" data-rate="'+json.results[i].details_level_1[j].details_level_2[k].score+'">',injectData+='<div class="btn-bar">',injectData+="<h3>"+json.results[i].details_level_1[j].details_level_2[k].title+"</h3>",injectData+='<div class="control">',injectData+='<span class="rate">'+json.results[i].details_level_1[j].details_level_2[k].score+"</span>",injectData+='<button class="icon-toggle js-toggle">',injectData+='<span class="visuallyhidden">Toggle</span>',injectData+="</button>",injectData+="</div>",injectData+="</div>",injectData+='<div class="note">',""!==json.results[i].details_level_1[j].details_level_2[k].description&&(injectData+='<i class="icon icon-info"></i><p>'+json.results[i].details_level_1[j].details_level_2[k].description+"</p>"),injectData+='<div class="comments">',injectData+='<div class="wrap first">',injectData+='<div class="col col-6 first">',injectData+="<h4>Criteria</h4>",injectData+="<p>"+json.results[i].details_level_1[j].details_level_2[k].criteria+"</p>",injectData+="</div>",injectData+='<div class="col col-6 last">',injectData+="<h4>A high score indicates</h4>",injectData+="<p>"+json.results[i].details_level_1[j].details_level_2[k].indicator_for+"</p>",injectData+="</div>",injectData+="</div>",injectData+='<div class="wrap last">',injectData+="<h4>Recommendations</h4>",injectData+="<p>"+json.results[i].details_level_1[j].details_level_2[k].recommendations+"</p>",""!==json.results[i].details_level_1[j].details_level_2[k].assessor&&(injectData+="<hr/>",injectData+="<h4>Assessor's Comments</h4>",injectData+="<p>"+json.results[i].details_level_1[j].details_level_2[k].assessor+"</p>"),injectData+="</div>",injectData+="</div>",injectData+="</div>",injectData+="</div>";injectData+="</div>"}injectData+="</div>",injectData+="</div>"}$(".intro .wrap").empty().html(introData),$(".results .cont").empty().html(injectData),enableBars()}var jsonPath="/json/home.json",loc="",$secondaryNav=$("#secondary-nav"),$main=$("#main"),$results=$(".results"),$about=$(".about"),$btnAbout=$(".btn-about");$secondaryNav.on("click","a",function(e){e.preventDefault();var $this=$(this).parent(),_ind=$this.index();if($results.slideDown(),$about.slideUp(),!$this.hasClass("active")){switch($secondaryNav.find(".active").removeClass("active"),$this.addClass("active"),$main.removeClass(),_ind){case 0:break;case 1:$main.addClass("inside strategy");break;case 2:$main.addClass("inside social");break;case 3:$main.addClass("inside web")}loadJson()}}),$btnAbout.on("click",function(e){e.preventDefault(),$secondaryNav.find(".active").removeClass("active"),$main.removeClass(),$results.slideUp(),$about.slideDown()}),$secondaryNav.find(".first a").trigger("click")}(),function(){var pickerFrom,pickerTo;pickerFrom=new Pikaday({field:document.getElementById("inputDateFrom"),onSelect:function(date){var set_date=moment(date).add(3,"months");pickerTo.setMoment(set_date,!0)}}),pickerTo=new Pikaday({field:document.getElementById("inputDateTo"),onSelect:function(date){var set_date=moment(date).subtract(3,"months");pickerFrom.setMoment(set_date,!0)}})}();var $dashboard=$(".dashboard");$(".js-assessment-chkbx",$dashboard).click(function(){var $this=$(this),$input=$this.parent().parent().find(".input-txt");$input.val(""),1==$input.prop("disabled")?$input.prop("disabled",!1):$input.prop("disabled",!0)}),$(".js-input-audience",$dashboard).keyup(function(){var $this=$(this);""==$this.val().trim()?($(".js-input-scenario",$this.parent()).val(""),$(".js-input-scenario",$this.parent()).prop("disabled",!0)):$(".js-input-scenario",$this.parent()).prop("disabled",!1)}),$(".js-load-social-data",$dashboard).click(function(){var $this=$(this);$this.addClass("is-loading"),$this.find(".label").html("Loading..."),$this.prop("disabled",!0),setTimeout(function(){var $download_link=$this.parent().find(".cta");$this.hide(),$download_link.fadeIn()},3e3)});var $loadAssessment=$(".js-load-assessment"),$assessmentList=$(".assessment-list"),emptyField=0;$loadAssessment.on("click",function(){$assessmentList.find("input").each(function(){$(this).val()&&(emptyField+=1),console.log(emptyField),emptyField>0&&($(".cta-disabled").removeAttr("disabled").removeClass("cta-disabled"),$loadAssessment.next().fadeIn())})})})}(jQuery);